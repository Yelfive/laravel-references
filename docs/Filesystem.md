# File System in Laravel

## Storage path

- Storage is set by calling `\Illuminate\Foundation\Application::useStoragePath()`
- If the method above is not called, the 
    
    ```php
    <?php
    $this->basePath . DIRECTORY_SEPARATOR . 'storage'
    ```

    will be used and the `$this->basePath` is defined by calling  

    ```php
    <?php
    new \Illuminate\Foundation\Application($basePath)
    ```

    **see also** `\Illuminate\Foundation\Application::storagePath()`

## Store uploaded file

### Store uploaded file with random name

**Usage**

```php
<?php
$filename = $request->file('file_name')->store($relativePathToRoot, $options = []);
```

**Description**

- The name is a unique hash generated by Laravel

- The extension of the file is determined by its mime type

- `$relativePathToRoot` above is a directory relative to `root` of the filesystem

- `root` is defined in `config/filesystems.php` with key `disks.local.root`

    ```php
    <?php
    # config/filesystems.php
    return [
        'default' => 'local',
        'disks' => [
            'local' => [
                'driver' => 'local',
                'root' => storage_path('app'), // <--- HERE
            ],
            'public' => [
                'driver' => 'local',
                'root' => storage_path('app/public'),
                'url' => env('APP_URL').'/storage',
                'visibility' => 'public',
            ],
        ]
    ];
    ```

    In case you have noticed the key `default` in the config array.
    It is the disk used for store your files.
- `$filename` returned, is the `$relativePathToRoot/$hashedname.$extension`

**Options**

If you want to store in disk other than default,
just define the disk config array in `disks`, say `public`.
Then use it like this:

```php
<?php
$request->file('file_name')->store('avatar', ['disk' => 'public']);
```

Notice the `public` above, it specify which config array to apply

**Real Path**

It's a bit complicated to get a stored file's real path. Let's see

```php
<?php
$storedName = $request->file('avatar')->store('image/avatar');
if ($storedName === false) {
    \\ throw something
}
$realPath = Storage::disk()->getDriver()->getAdapter()->applyPathPrefix($storedName);
```

